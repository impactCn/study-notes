# 2 高可用的Linux集群
## 2.1 高可用集群基础
### 2.1.1 高可用衡量标准
     公式：HA[高可用] = MTTF[平均无故障的时间] / (MTTF[平均无故障的时间] + MTTR[平均维护时间]) * 100%
* 99%为一年宕机时间不超过4天
* 99.9%为一年宕机时间不超过10小时
* 99.99%为一年宕机时间不超过1小时
* 99.999%为一年宕机时间不超过6分钟

### 2.1.2 高可用层次结构
由底向高分依次为：架构层、资源调度层、应用层。
* 架构层：负责传递心跳信息、集群事物信息。
* 资源调度层：实现资源调度分配的管理层。
* 运行整个集群的业务应用与各种对外服务。

### 2.1.3 常见的高可用方案
* 共享存储
  * 通过网络传输数据实现在多台设备上存储数据：多主读写
  * 通过直接存储实现在多个硬件设备上存储备份数据文件：主从复制

* 故障转移
  * 当检测到主服务器“心跳”报警后，备用服务器就会接管服务

* 负载均衡

* 分布集群

## 2.2 虚拟服务的实现
实现高可用，要解决的最大问题就是负载均衡，实现负载均衡的主要过程就是实现虚拟服务。解决网络服务性能问题的方案可以分成以下四种：DNS轮询、客户端调度、应用层负载调度和IP层负载调度。

### 2.2.1 DNS轮询
* TTL问题：若过大则容易造成负载不均，若过小则容易增加了域名解析的网络流量。
* 负载压力问题：RR-DNS并不能监控应用服务的压力，只会根据响应最快的服务组映射到用户。
* 系统扩展维护问题：若应用服务器失效，该应用服务器的用户只会看到服务中断，刷新也没有用。而且还不能改变RR-DNS服务器中的IP地址列表，只能等待TTL过期，用户才能重新缓存。

### 2.2.2 客户端调度
* 客户端随机选取应用服务器。
* 客户端基于客户端内部的监控，通过获取应用服务器的负载情况，让客户端选择压力较小的应用服务器。

### 2.2.3 应用层负载调度（第七层负载均衡）
* 当用户的请求带调度器时，请求会提交给负载均衡调度器，它会分析请求根据各个应用服务器的负载情况，重写请求并发送到其中的一台应用服务器上，取得结果在返回给用户。

### 2.2.4 IP层负载调度（第三层负载均衡）
* 分配虚拟IP，请求虚拟IP，访问对应的应用服务器。

### 补充 第四层负载均衡









